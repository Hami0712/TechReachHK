<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TechReach HK - Conditions Life Game</title>
<style>
  :root{
    --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --panel:#ffffff;      
    --ink:#0f172a;        
    --muted:#475569;      
    --accent:#2563eb;     
    --accent-2:#22c55e;   
    --accent-3:#f59e0b;   
    --accent-4:#ef4444;   
    --accent-5:#8b5cf6;   
    --line:#cbd5e1;       
    --chip:#eef2ff;
    --shadow: 0 10px 25px rgba(0,0,0,0.1);
    --shadow-hover: 0 20px 40px rgba(0,0,0,0.15);
    --good:#16a34a; 
    --bad:#dc2626; 
    --warn:#b45309; 
    --gold:#f59e0b;
  }
  *{ box-sizing:border-box; }
  html,body{ margin:0; padding:0; background:var(--bg); color:var(--ink); font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; min-height:100vh; }
  body{ font-size:18px; line-height:1.55; }
  .wrap{max-width:1200px; margin-inline:auto; padding:24px;}
  header{
    display:flex; align-items:center; gap:20px; margin-bottom:32px; 
    background:rgba(255,255,255,0.95); padding:24px; border-radius:20px; 
    box-shadow:var(--shadow); backdrop-filter:blur(10px);
  }
  header .logo{
    width:60px;height:60px; border-radius:16px; 
    background:linear-gradient(135deg,var(--accent),#60a5fa); 
    display:grid; place-items:center; color:#fff; font-weight:800; font-size:24px;
    box-shadow: 0 8px 16px rgba(37, 99, 235, 0.3);
  }
  h1{font-size:clamp(28px,4vw,42px); margin:0; background:linear-gradient(135deg,var(--accent),var(--accent-2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;}
  .subtitle{color:var(--muted); margin-top:8px; font-size:18px;}
  
  /* Language toggle */
  .lang-toggle{
    margin-left:auto; display:flex; align-items:center; gap:8px;
    background:rgba(255,255,255,0.1); padding:8px 16px; 
    border-radius:20px; border:1px solid rgba(255,255,255,0.2);
    backdrop-filter:blur(10px); transition:all 0.3s ease;
  }
  .lang-toggle:hover{background:rgba(255,255,255,0.2);}
  .lang-toggle button{
    background:none; border:none; color:var(--ink); font-size:14px; 
    font-weight:600; padding:4px 8px; border-radius:8px; 
    cursor:pointer; transition:all 0.2s ease;
  }
  .lang-toggle button.active{
    background:var(--accent); color:#fff; box-shadow:0 2px 8px rgba(37, 99, 235, 0.3);
  }
  .lang-toggle button:not(.active):hover{
    background:rgba(37, 99, 235, 0.1); color:var(--accent);
  }
  
  /* Navigation buttons - consistent sizing */
  .back-btn, .next-lesson-btn, .back-to-index-btn{
    background:var(--accent); color:#fff; border:none; padding:12px 20px; 
    border-radius:12px; font-weight:600; cursor:pointer; transition:all 0.3s ease;
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    text-decoration:none; display:inline-flex; align-items:center; gap:8px;
    min-width: 140px; height: 48px; justify-content: center;
  }
  .back-btn:hover{
    background:#1d4ed8; transform:translateY(-2px); box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
  }
  .next-lesson-btn{ background:var(--accent-5); box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3); }
  .next-lesson-btn:hover{ background:#7c3aed; transform:translateY(-2px); box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4); }
  .back-to-index-btn{ background:var(--accent-2); box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3); }
  .back-to-index-btn:hover{ background:#16a34a; transform:translateY(-2px); box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4); }
  
  main{ max-width:980px; margin:0 auto; padding:16px; }
  .card{ 
    background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
    backdrop-filter: blur(5px); border:2px solid var(--line); border-radius:16px; 
    padding:20px; margin:12px 0; box-shadow:var(--shadow); transition:all 0.3s ease;
  }
  .card:hover{ transform:translateY(-2px); box-shadow:var(--shadow-hover); }
  .row{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
  button{ font-size:18px; padding:10px 14px; border-radius:10px; border:2px solid #0f172a; background:#fff; color:#0f172a; }
  button:hover{ outline:3px solid var(--accent); cursor:pointer; }
  button:focus{ outline:4px solid var(--accent); }
  .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#fff; border-radius:6px; padding:2px 6px; border:1px solid #0f172a; }
  .story{ background:#fff; border:2px dashed #0f172a; border-radius:12px; padding:16px; margin:12px 0; }
  .options{ display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
  .opt{ padding:8px 12px; border-radius:10px; border:2px solid #0f172a; background:#fff; cursor:pointer; text-align:left; line-height:1.4; }
  .opt.correct{ background:#dcfce7; }
  .opt.wrong{ background:#fee2e2; }
  .opt small{ display:block; color:var(--muted); font-size:14px; margin-top:4px; font-weight:normal; }
  .code{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#fff; border-radius:10px; padding:10px; border:2px dashed #0f172a; }
  .good{ color:var(--good); font-weight:700; }
  .bad{ color:var(--bad); font-weight:700; }
  .hidden{ display:none; }
  /* Level badge */
  .level-badge{ display:inline-block; font-weight:700; padding:6px 10px; border-radius:10px; background:#fff; border:2px solid var(--line); box-shadow:var(--shadow); }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true">ğŸŒ</div>
      <div>
        <h1 data-en="Conditions Life Game" data-zh="æ¢ä»¶ç”Ÿæ´»éŠæˆ²">Conditions Life Game</h1>
        <div class="subtitle" data-en="Learn if, elif, else, and while with real examples" data-zh="é€šéçœŸå¯¦ä¾‹å­å­¸ç¿’ ifã€elifã€else å’Œ while">Learn if, elif, else, and while with real examples</div>
      </div>
      <div class="lang-toggle">
        <button class="active" onclick="switchLanguage('en')">EN</button>
        <button onclick="switchLanguage('zh')">ç¹ä¸­</button>
      </div>
    </header>
    
    <div style="margin-bottom: 20px; display: flex; gap: 12px; align-items: center;">
      <a href="5. Pattern Game.html" class="back-btn">
        â† <span data-en="Previous Lesson" data-zh="ä¸Šä¸€èª²">Previous Lesson</span>
      </a>
      <button id="nextLessonBtn" class="next-lesson-btn" data-en="Next Lesson â†’" data-zh="ä¸‹ä¸€èª² â†’">Next Lesson â†’</button>
      <button id="backToIndexBtn" class="back-to-index-btn" data-en="Back to All Lessons" data-zh="è¿”å›é¦–é ">Back to All Lessons</button>
      <span id="lvl" class="level-badge" aria-live="polite">Level 1 / 6</span>
    </div>

<main>
  <div class="card">
    <p data-en="<strong>Learn:</strong> <em>Conditional Logic & Decision Making</em> â€” use <code>if</code>, <code>elif</code>, <code>else</code>, and <code>while</code> to make decisions in code.<br/><strong>Why it matters:</strong> Conditions help programs respond to different situations and make smart decisions automatically." data-zh="<strong>å­¸ç¿’ï¼š</strong> <em>æ¢ä»¶é‚è¼¯èˆ‡æ±ºç­–åˆ¶å®š</em> â€” ä½¿ç”¨<code>if</code>ã€<code>elif</code>ã€<code>else</code>å’Œ<code>while</code>åœ¨ç¨‹å¼ç¢¼ä¸­åšæ±ºå®šã€‚<br/><strong>ç‚ºä»€éº¼é‡è¦ï¼š</strong> æ¢ä»¶å¹«åŠ©ç¨‹å¼å›æ‡‰ä¸åŒæƒ…æ³ä¸¦è‡ªå‹•åšå‡ºæ˜æ™ºæ±ºå®šã€‚"><strong>Learn:</strong> <em>Conditional Logic & Decision Making</em> â€” use <code>if</code>, <code>elif</code>, <code>else</code>, and <code>while</code> to make decisions in code.<br/><strong>Why it matters:</strong> Conditions help programs respond to different situations and make smart decisions automatically.</p>
  </div>

  <div class="card">
    <div id="storyCard" class="story">
      <h3 id="storyTitle">Loading...</h3>
      <p id="storyText"></p>
      <div id="storyOptions" class="options"></div>
      <div id="storyFeedback" class="muted"></div>
    </div>

    <div id="codeCard" class="story hidden">
      <h3 data-en="Write the code:" data-zh="å¯«ç¨‹å¼ç¢¼ï¼š">Write the code:</h3>
      <p id="codePrompt"></p>
      <textarea id="code" style="width:100%; height:160px; border:2px solid #0f172a; border-radius:10px; padding:10px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:16px;" placeholder="if raining():
  take_umbrella()
else:
  leave_umbrella()"></textarea>
      <div class="row" style="margin-top:10px">
        <button id="checkCodeBtn" data-en="Check Code" data-zh="æª¢æŸ¥ç¨‹å¼ç¢¼">Check Code</button>
        <button id="resetCodeBtn" data-en="Reset" data-zh="é‡ç½®">Reset</button>
        <div id="codeFeedback" class="muted"></div>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <button id="nextBtn" class="hidden" data-en="Next Level" data-zh="ä¸‹ä¸€é—œ">Next Level</button>
      <button id="hintBtn" data-en="Hint" data-zh="æç¤º">Hint</button>
    </div>
  </div>
</main>
  </div>

<script>
// Language switching functionality (no reliance on event.target)
function switchLanguage(lang) {
  // Update button states
  document.querySelectorAll('.lang-toggle button').forEach(btn => btn.classList.remove('active'));
  const targetBtn = document.querySelector(`.lang-toggle button[onclick="switchLanguage('${lang}')"]`);
  if (targetBtn) targetBtn.classList.add('active');
  
  // Update all elements with data attributes
  document.querySelectorAll('[data-en][data-zh]').forEach(element => {
    element.innerHTML = (lang === 'zh') ? element.getAttribute('data-zh') : element.getAttribute('data-en');
  });
  
  // Update HTML lang attribute
  document.documentElement.lang = (lang === 'zh') ? 'zh-Hant' : 'en';
  
  // Store language preference
  localStorage.setItem('preferredLanguage', lang);
  
  // Refresh current level content with new language
  const L = currentLevel();
  if (L.type === 'story') {
    drawStory();
  } else {
    drawCode();
  }
}

// Load saved language preference on page load
document.addEventListener('DOMContentLoaded', function() {
  const savedLang = localStorage.getItem('preferredLanguage') || 'en';
  if (savedLang === 'zh') {
    // Update button states
    document.querySelectorAll('.lang-toggle button').forEach(btn => btn.classList.remove('active'));
    const zhBtn = document.querySelector(`.lang-toggle button[onclick="switchLanguage('zh')"]`);
    if (zhBtn) zhBtn.classList.add('active');
    // Update content
    document.querySelectorAll('[data-en][data-zh]').forEach(element => {
      element.innerHTML = element.getAttribute('data-zh');
    });
    document.documentElement.lang = 'zh-Hant';
  }
  
  // Initialize navigation buttons
  initializeNavigationButtons();
  
  // Initialize the game
  const L = currentLevel();
  if (L.type === 'story') {
    drawStory();
  } else {
    drawCode();
  }
});

// Navigation functions
function nextLesson(){
  window.location.href = '7. Conditions Game.html';
}
function backToIndex(){
  window.location.href = '../index.html';
}
function initializeNavigationButtons(){
  const nextLessonBtn = document.getElementById('nextLessonBtn');
  if (nextLessonBtn) nextLessonBtn.addEventListener('click', nextLesson);
  const backToIndexBtn = document.getElementById('backToIndexBtn');
  if (backToIndexBtn) backToIndexBtn.addEventListener('click', backToIndex);
}
</script>

<script>
let lvl = 0;
let storyComplete = false;

const LEVELS = [
  // 1: Simple if/else
  {
    type: 'story',
    title: { en: 'ğŸŒ§ï¸ Rain Check', zh: 'ğŸŒ§ï¸ é›¨å¤©æª¢æŸ¥' },
    text: { 
      en: 'You\'re about to leave home. It\'s raining outside. What should you do?',
      zh: 'ä½ æ­£è¦é›¢é–‹å®¶ã€‚å¤–é¢æ­£åœ¨ä¸‹é›¨ã€‚ä½ æ‡‰è©²æ€éº¼åšï¼Ÿ'
    },
    options: [
      { 
        text: { 
          en: 'if raining(): take_umbrella()', 
          zh: 'if raining(): take_umbrella()<br/><small>å¦‚æœä¸‹é›¨ï¼šæ‹¿é›¨å‚˜</small>' 
        }, 
        correct: true 
      },
      { 
        text: { 
          en: 'if sunny(): take_umbrella()', 
          zh: 'if sunny(): take_umbrella()<br/><small>å¦‚æœæ™´å¤©ï¼šæ‹¿é›¨å‚˜</small>' 
        }, 
        correct: false 
      },
      { 
        text: { 
          en: 'always take_umbrella()', 
          zh: 'always take_umbrella()<br/><small>ç¸½æ˜¯æ‹¿é›¨å‚˜</small>' 
        }, 
        correct: false 
      }
    ],
    hint: { en: 'Check the condition first, then decide what to do.', zh: 'å…ˆæª¢æŸ¥æ¢ä»¶ï¼Œç„¶å¾Œæ±ºå®šè¦åšä»€éº¼ã€‚' }
  },
  // 2: if/elif/else
  {
    type: 'story',
    title: { en: 'ğŸ• Pizza Order', zh: 'ğŸ• æŠ«è–©è¨‚è³¼' },
    text: { 
      en: 'You\'re ordering pizza. If you have $20, get large. If you have $15, get medium. Otherwise get small.',
      zh: 'ä½ æ­£åœ¨è¨‚æŠ«è–©ã€‚å¦‚æœä½ æœ‰20å…ƒï¼Œé»å¤§ä»½ã€‚å¦‚æœä½ æœ‰15å…ƒï¼Œé»ä¸­ä»½ã€‚å¦å‰‡é»å°ä»½ã€‚'
    },
    options: [
      { 
        text: { 
          en: 'if money >= 20: large; elif money >= 15: medium; else: small', 
          zh: 'if money >= 20: large; elif money >= 15: medium; else: small<br/><small>å¦‚æœéŒ¢>=20ï¼šå¤§ä»½ï¼›å¦å‰‡å¦‚æœéŒ¢>=15ï¼šä¸­ä»½ï¼›å¦å‰‡ï¼šå°ä»½</small>' 
        }, 
        correct: true 
      },
      { 
        text: { 
          en: 'if money >= 15: medium; elif money >= 20: large; else: small', 
          zh: 'if money >= 15: medium; elif money >= 20: large; else: small<br/><small>å¦‚æœéŒ¢>=15ï¼šä¸­ä»½ï¼›å¦å‰‡å¦‚æœéŒ¢>=20ï¼šå¤§ä»½ï¼›å¦å‰‡ï¼šå°ä»½</small>' 
        }, 
        correct: false 
      },
      { 
        text: { 
          en: 'if money >= 20: large; if money >= 15: medium; else: small', 
          zh: 'if money >= 20: large; if money >= 15: medium; else: small<br/><small>å¦‚æœéŒ¢>=20ï¼šå¤§ä»½ï¼›å¦‚æœéŒ¢>=15ï¼šä¸­ä»½ï¼›å¦å‰‡ï¼šå°ä»½</small>' 
        }, 
        correct: false 
      }
    ],
    hint: { en: 'Use elif to check multiple conditions in order.', zh: 'ä½¿ç”¨ elif æŒ‰é †åºæª¢æŸ¥å¤šå€‹æ¢ä»¶ã€‚' }
  },
  // 3: while loop
  {
    type: 'story',
    title: { en: 'ğŸ“š Study Session', zh: 'ğŸ“š å­¸ç¿’æ™‚é–“' },
    text: { 
      en: 'You need to study until you understand the topic. How do you keep studying?',
      zh: 'ä½ éœ€è¦å­¸ç¿’ç›´åˆ°ç†è§£é€™å€‹ä¸»é¡Œã€‚ä½ å¦‚ä½•æŒçºŒå­¸ç¿’ï¼Ÿ'
    },
    options: [
      { 
        text: { 
          en: 'while not_understood(): keep_studying()', 
          zh: 'while not_understood(): keep_studying()<br/><small>ç•¶ä¸ç†è§£æ™‚ï¼šç¹¼çºŒå­¸ç¿’</small>' 
        }, 
        correct: true 
      },
      { 
        text: { 
          en: 'if not_understood(): keep_studying()', 
          zh: 'if not_understood(): keep_studying()<br/><small>å¦‚æœä¸ç†è§£ï¼šç¹¼çºŒå­¸ç¿’</small>' 
        }, 
        correct: false 
      },
      { 
        text: { 
          en: 'repeat 5: keep_studying()', 
          zh: 'repeat 5: keep_studying()<br/><small>é‡è¤‡5æ¬¡ï¼šç¹¼çºŒå­¸ç¿’</small>' 
        }, 
        correct: false 
      }
    ],
    hint: { en: 'Use while to repeat until a condition is met.', zh: 'ä½¿ç”¨ while é‡è¤‡ç›´åˆ°æ»¿è¶³æ¢ä»¶ã€‚' }
  },
  // 4: Code practice - if/else
  {
    type: 'code',
    title: { en: 'ğŸš¦ Traffic Light', zh: 'ğŸš¦ äº¤é€šç‡ˆ' },
    prompt: { 
      en: 'Write code: If the light is green, go. If red, stop. Otherwise (yellow), slow down.',
      zh: 'å¯«ç¨‹å¼ç¢¼ï¼šå¦‚æœç‡ˆæ˜¯ç¶ è‰²ï¼Œå‰é€²ã€‚å¦‚æœæ˜¯ç´…è‰²ï¼Œåœæ­¢ã€‚å¦å‰‡ï¼ˆé»ƒè‰²ï¼‰ï¼Œæ¸›é€Ÿã€‚'
    },
    solution: 'if light == "green":\n  go()\nelif light == "red":\n  stop()\nelse:\n  slow_down()',
    hint: { en: 'Use if/elif/else to handle three different cases.', zh: 'ä½¿ç”¨ if/elif/else è™•ç†ä¸‰ç¨®ä¸åŒçš„æƒ…æ³ã€‚' }
  },
  // 5: Code practice - while
  {
    type: 'code',
    title: { en: 'ğŸƒ Exercise Routine', zh: 'ğŸƒ é‹å‹•ä¾‹è¡Œ' },
    prompt: { 
      en: 'Write code: Keep running while you have energy. When energy runs out, rest.',
      zh: 'å¯«ç¨‹å¼ç¢¼ï¼šç•¶ä½ æœ‰é«”åŠ›æ™‚æŒçºŒè·‘æ­¥ã€‚ç•¶é«”åŠ›è€—ç›¡æ™‚ï¼Œä¼‘æ¯ã€‚'
    },
    solution: 'while energy > 0:\n  run()\nrest()',
    hint: { en: 'Use while to repeat until a condition changes.', zh: 'ä½¿ç”¨ while é‡è¤‡ç›´åˆ°æ¢ä»¶æ”¹è®Šã€‚' }
  },
  // 6: Code practice - complex
  {
    type: 'code',
    title: { en: 'ğŸ® Game Character', zh: 'ğŸ® éŠæˆ²è§’è‰²' },
    prompt: { 
      en: 'Write code: If health is low, use potion. Elif enemy nearby, attack. Elif treasure found, collect. Else, explore.',
      zh: 'å¯«ç¨‹å¼ç¢¼ï¼šå¦‚æœç”Ÿå‘½å€¼ä½ï¼Œä½¿ç”¨è—¥æ°´ã€‚å¦‚æœæ•µäººåœ¨é™„è¿‘ï¼Œæ”»æ“Šã€‚å¦‚æœç™¼ç¾å¯¶è—ï¼Œæ”¶é›†ã€‚å¦å‰‡ï¼Œæ¢ç´¢ã€‚'
    },
    solution: 'if health < 20:\n  use_potion()\nelif enemy_nearby():\n  attack()\nelif treasure_found():\n  collect()\nelse:\n  explore()',
    hint: { en: 'Chain multiple conditions with if/elif/else.', zh: 'ä½¿ç”¨ if/elif/else éˆæ¥å¤šå€‹æ¢ä»¶ã€‚' }
  }
];

function currentLevel(){ return LEVELS[lvl]; }

function setFeedback(msg, cls){
  const el = document.getElementById('storyFeedback');
  el.className = cls ? cls : 'muted';
  el.textContent = msg;
}

function setCodeFeedback(msg, cls){
  const el = document.getElementById('codeFeedback');
  el.className = cls ? cls : 'muted';
  el.textContent = msg;
}

function updateLevelBadge(){
  const badge = document.getElementById('lvl');
  if (badge) badge.textContent = `Level ${lvl+1} / ${LEVELS.length}`;
}

function drawStory(){
  const L = currentLevel();
  updateLevelBadge();
  
  // Get current language
  const currentLang = document.documentElement.lang === 'zh-Hant' ? 'zh' : 'en';
  
  // Update title and text with language-specific content
  document.getElementById('storyTitle').textContent = L.title[currentLang] || L.title;
  document.getElementById('storyText').textContent = L.text[currentLang] || L.text;
  
  const optionsDiv = document.getElementById('storyOptions');
  optionsDiv.innerHTML = '';
  L.options.forEach((opt) => {
    const btn = document.createElement('button');
    btn.className = 'opt';
    btn.innerHTML = opt.text[currentLang] || opt.text;
    btn.addEventListener('click', () => {
      optionsDiv.querySelectorAll('.opt').forEach(b => b.classList.remove('correct', 'wrong'));
      btn.classList.add(opt.correct ? 'correct' : 'wrong');
      setFeedback(opt.correct ? 'Great choice! âœ…' : 'Not quite. Try again.', opt.correct ? 'good' : 'bad');
      if (opt.correct) {
        storyComplete = true;
        document.getElementById('nextBtn').classList.remove('hidden');
      }
    });
    optionsDiv.appendChild(btn);
  });
  
  setFeedback('Choose the best answer.', '');
  document.getElementById('nextBtn').classList.add('hidden');
  document.getElementById('storyCard').classList.remove('hidden');
  document.getElementById('codeCard').classList.add('hidden');
}

function drawCode(){
  const L = currentLevel();
  updateLevelBadge();
  
  // Get current language
  const currentLang = document.documentElement.lang === 'zh-Hant' ? 'zh' : 'en';
  
  // Update prompt with language-specific content
  document.getElementById('codePrompt').textContent = L.prompt[currentLang] || L.prompt;
  document.getElementById('code').value = '';
  
  const feedbackText = currentLang === 'zh' ? 'åœ¨ä¸Šæ–¹å¯«å…¥ä½ çš„ç¨‹å¼ç¢¼ï¼Œç„¶å¾Œé»æ“Šæª¢æŸ¥ã€‚' : 'Write your code above, then click Check.';
  setCodeFeedback(feedbackText, '');
  document.getElementById('nextBtn').classList.add('hidden');
  document.getElementById('storyCard').classList.add('hidden');
  document.getElementById('codeCard').classList.remove('hidden');
}

function checkCode(){
  const userCode = document.getElementById('code').value.toLowerCase().trim();
  const solution = currentLevel().solution.toLowerCase().trim();
  
  // Simple similarity check
  const userLines = userCode.split('\n').map(l => l.trim()).filter(l => l);
  const solutionLines = solution.split('\n').map(l => l.trim()).filter(l => l);
  
  let score = 0;
  solutionLines.forEach(solLine => {
    if (userLines.some(userLine => userLine.includes(solLine.split(':')[0]) && userLine.includes(':'))) {
      score++;
    }
  });
  
  const threshold = Math.ceil(solutionLines.length * 0.7);
  if (score >= threshold) {
    setCodeFeedback('Great job! Your code looks correct. âœ…', 'good');
    document.getElementById('nextBtn').classList.remove('hidden');
  } else {
    setCodeFeedback(`Keep trying! You got ${score}/${solutionLines.length} parts right.`, 'bad');
  }
}

function showHint(){
  const L = currentLevel();
  if (L.hint) {
    if (L.type === 'story') {
      setFeedback(L.hint, '');
    } else {
      setCodeFeedback(L.hint, '');
    }
  }
}

// Event listeners
document.getElementById('checkCodeBtn').addEventListener('click', checkCode);
document.getElementById('resetCodeBtn').addEventListener('click', () => {
  document.getElementById('code').value = '';
  setCodeFeedback('Code cleared. Try again!', '');
});
document.getElementById('nextBtn').addEventListener('click', () => {
  if (lvl < LEVELS.length - 1) {
    lvl++;
    storyComplete = false;
    const L = currentLevel();
    if (L.type === 'story') {
      drawStory();
    } else {
      drawCode();
    }
  } else {
    setFeedback('Congratulations! You completed all levels! ğŸ‰', 'good');
  }
});
document.getElementById('hintBtn').addEventListener('click', showHint);
</script>
</body>
</html>